---
title: "BLS12-381"
description: "BLS12381, BLS12-381 curve"
tags: [ethereum, cryptography, elliptic-curve, BLS12-381, pairing]
sidebar:
  order: 7
---

# BLS12-381

> 本文聚焦 Ethereum 特定的實現細節。通用理論請參見 [BLS12-381 曲線參數](/fundamentals/cryptography/bls12-381/)。

## 概述

BLS12-381 是 Ethereum 共識層（[Beacon Chain](/ethereum/consensus/beacon-chain/)）使用的 pairing-friendly 橢圓曲線。關於曲線方程、域參數、$G_1$/$G_2$/$G_T$ 群、配對數學和安全強度的完整說明，請參見 [通用理論](/fundamentals/cryptography/bls12-381/)。

## 在 Ethereum 中的應用

- **[BLS Signatures](/ethereum/cryptography/bls-signatures/)**：[Validators](/ethereum/consensus/validators/) 使用 BLS 簽名進行 [Attestation](/ethereum/consensus/attestation/)，簽名可聚合以降低頻寬和驗證成本
- **[KZG Commitments](/ethereum/advanced/kzg-commitments/)**：[EIP-4844 Proto-Danksharding](/ethereum/advanced/eip-4844/) 使用 BLS12-381 上的 KZG 多項式承諾
- **Trusted Setup**：KZG 需要 structured reference string（SRS），基於 BLS12-381 的 $G_1, G_2$ 點
- **[RANDAO](/ethereum/consensus/randao/)**：使用 BLS 簽名的確定性特性來混合隨機性

### Ethereum 的群分配

Ethereum [BLS Signatures](/ethereum/cryptography/bls-signatures/) 選擇公鑰在 $G_1$（48 bytes），簽名在 $G_2$（96 bytes），因為 Beacon Chain 需要頻繁聚合公鑰。

### 與 BN254 在 Ethereum 中的共存

| | BN254 | BLS12-381 |
|--|-------|-----------|
| 安全強度 | ~100 bit | ~128 bit |
| EVM precompile | 0x06-0x08（原有） | 0x0B-0x13（EIP-2537，Pectra 上線） |
| 用途 | 舊版 zkSNARK | Beacon Chain, KZG, 新 precompile |

BN254（alt_bn128）因安全強度不足，逐漸被 BLS12-381 取代。自 Pectra 升級後，EVM 已原生支援 BLS12-381 操作。

### EIP-2537 預編譯合約（Pectra 2025/5/7 上線）

EIP-2537 是 BLS12-381 在 Ethereum 執行層的里程碑——在提案多年後終於在 Pectra 升級正式上線。新增 9 個 [Precompiled Contracts](/ethereum/advanced/precompiled-contracts/)，地址 0x0B 至 0x13：

| 地址 | 操作 | Gas Cost | 說明 |
|------|------|----------|------|
| `0x0B` | G1Add | 375 | $G_1$ 點加法 |
| `0x0C` | G1Mul | 12000 | $G_1$ 純量乘法 |
| `0x0D` | G1MultiExp | 動態 | $G_1$ multi-scalar multiplication |
| `0x0E` | G2Add | 600 | $G_2$ 點加法 |
| `0x0F` | G2Mul | 22500 | $G_2$ 純量乘法 |
| `0x10` | G2MultiExp | 動態 | $G_2$ multi-scalar multiplication |
| `0x11` | Pairing | 動態 | bilinear pairing 驗證 |
| `0x12` | MapToG1 | 5500 | field element 映射到 $G_1$ |
| `0x13` | MapToG2 | 23800 | field element 映射到 $G_2$ |

**輸入格式**：$G_1$ 點使用 128 bytes（x, y 各 64 bytes，zero-padded），$G_2$ 點使用 256 bytes。標量為 32 bytes（little-endian）。

**意義**：
- 執行層終於可以原生驗證共識層的 BLS 簽名
- [zkSNARKs 支援](/ethereum/advanced/zksnarks/) 可以遷移到更安全的 BLS12-381 曲線
- 跨鏈橋、輕客戶端合約等應用有了更強的密碼學基礎
- 與 BN254 precompile（0x06-0x08）並存，向後相容

## 程式碼範例

```python
# 使用 py_ecc 庫操作 BLS12-381（Ethereum 共識層使用的方案）
from py_ecc.bls import G2ProofOfPossession as bls
from py_ecc.optimized_bls12_381 import (
    G1, G2, Z1, Z2,
    multiply, add, pairing, neg,
    curve_order,
)
import secrets

# === BLS 簽名（Ethereum Beacon Chain 方案）===
private_key = secrets.token_bytes(32)
public_key = bls.SkToPk(private_key)
print(f"Public key (48 bytes): {public_key.hex()[:32]}...")

message = b"attestation data"
signature = bls.Sign(private_key, message)
print(f"Signature (96 bytes): {signature.hex()[:32]}...")

is_valid = bls.Verify(public_key, message, signature)
print(f"Signature valid: {is_valid}")

# === 聚合簽名（模擬 Beacon Chain committee）===
num_validators = 5
keys = [secrets.token_bytes(32) for _ in range(num_validators)]
pubkeys = [bls.SkToPk(k) for k in keys]
signatures = [bls.Sign(k, message) for k in keys]

agg_signature = bls.Aggregate(signatures)
print(f"Aggregated signature: {agg_signature.hex()[:32]}...")

is_valid = bls.AggregateVerify(pubkeys, [message] * num_validators, agg_signature)
print(f"Aggregate verification: {is_valid}")
```

## 相關概念

- [BLS12-381 曲線參數](/fundamentals/cryptography/bls12-381/) - 通用理論（曲線方程、域參數、配對數學、tower of extensions、安全強度）
- [橢圓曲線密碼學](/fundamentals/cryptography/elliptic-curve-cryptography/) - ECC 的通用原理
- [secp256k1](/ethereum/cryptography/secp256k1/) - 執行層使用的曲線（非 pairing-friendly）
- [BLS Signatures](/ethereum/cryptography/bls-signatures/) - 基於 BLS12-381 配對的簽章方案
- [KZG Commitments](/ethereum/advanced/kzg-commitments/) - 基於 BLS12-381 的多項式承諾
- [EIP-4844 Proto-Danksharding](/ethereum/advanced/eip-4844/) - 使用 KZG 承諾的 data blob
- [Beacon Chain](/ethereum/consensus/beacon-chain/) - 使用 BLS12-381 的共識層
- [Validators](/ethereum/consensus/validators/) - 使用 BLS 金鑰進行簽名
- [Attestation](/ethereum/consensus/attestation/) - validator 用 BLS 簽署的投票
- [RANDAO](/ethereum/consensus/randao/) - 利用 BLS 簽名的確定性
- [zkSNARKs 支援](/ethereum/advanced/zksnarks/) - 使用配對的零知識證明
- [Precompiled Contracts](/ethereum/advanced/precompiled-contracts/) - BN254 precompile（0x06-0x08）與 BLS12-381 precompile（0x0B-0x13，Pectra 上線）
