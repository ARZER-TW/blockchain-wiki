---
title: "BLS12-381"
description: "BLS12-381 pairing-friendly elliptic curve - parameters, groups, pairing math"
tags: [fundamentals, cryptography, elliptic-curve, BLS12-381, pairing]
---

# BLS12-381

## 概述

BLS12-381 是一條 pairing-friendly 橢圓曲線，由 Sean Bowe 設計。「BLS」指 Barreto-Lynn-Scott 構造，「12」是 embedding degree，「381」是基域質數的位元數。它支援雙線性配對（bilinear pairing）運算，是 [BLS Signatures](/fundamentals/cryptography/bls-signatures/) 聚合簽名、KZG 多項式承諾和 zkSNARKs 等進階密碼學協議的數學基礎。Ethereum、Zcash、Filecoin 等多個區塊鏈專案均採用此曲線。

## 核心原理

### 曲線方程

BLS12-381 實際上是一對曲線：

**$G_1$（定義在 $\mathbb{F}_p$ 上）：**

$$E_1: y^2 = x^3 + 4$$

**$G_2$（定義在 $\mathbb{F}_{p^2}$ 上）：**

$$E_2: y^2 = x^3 + 4(1 + i)$$

其中 $\mathbb{F}_{p^2} = \mathbb{F}_p[i] / (i^2 + 1)$，即 $\mathbb{F}_p$ 的二次擴展域。

### 域參數

**基域質數 $p$（381 bit）：**

$$p = \texttt{0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab}$$

$p$ 的特殊形式：$p = (x - 1)^2 \cdot (x^4 - x^2 + 1) / 3 + x$，其中 $x = -\texttt{0xd201000000010000}$。

**子群的階 $r$（255 bit）：**

$$r = \texttt{0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001}$$

$r$ 是質數，$r = x^4 - x^2 + 1$。

**Embedding degree**：$k = 12$

這意味著配對的目標群 $G_T$ 定義在 $\mathbb{F}_{p^{12}}$ 上。$k = 12$ 是安全性和效率的平衡——足夠大以抵抗 MOV attack，又不至於太大導致配對運算過慢。

### 雙線性配對（Bilinear Pairing）

核心運算 $e: G_1 \times G_2 \rightarrow G_T$，滿足：

**雙線性（Bilinearity）：**

$$e(aP, bQ) = e(P, Q)^{ab}$$

$$e(P + R, Q) = e(P, Q) \cdot e(R, Q)$$

$$e(P, Q + S) = e(P, Q) \cdot e(P, S)$$

**非退化（Non-degeneracy）：**

$$e(G_1, G_2) \neq 1_{G_T}$$

其中 $G_1, G_2$ 分別是 $G_1, G_2$ 的生成元。

**可計算性**：存在高效算法（Optimal Ate pairing）。

### 三個群

| 群 | 定義域 | 元素大小 | 用途 |
|----|--------|----------|------|
| $G_1$ | $E_1(\mathbb{F}_p)$ | 48 bytes（壓縮） | 公鑰或簽名（取決於方案） |
| $G_2$ | $E_2(\mathbb{F}_{p^2})$ | 96 bytes（壓縮） | 簽名或公鑰 |
| $G_T$ | $\mathbb{F}_{p^{12}}^*$ | 576 bytes | 配對結果 |

### Tower of Extensions

$\mathbb{F}_{p^{12}}$ 的建構方式是逐層擴展：

$$\mathbb{F}_p \rightarrow \mathbb{F}_{p^2} \rightarrow \mathbb{F}_{p^6} \rightarrow \mathbb{F}_{p^{12}}$$

- $\mathbb{F}_{p^2} = \mathbb{F}_p[u] / (u^2 + 1)$
- $\mathbb{F}_{p^6} = \mathbb{F}_{p^2}[v] / (v^3 - (u + 1))$
- $\mathbb{F}_{p^{12}} = \mathbb{F}_{p^6}[w] / (w^2 - v)$

這種 tower construction 使 $\mathbb{F}_{p^{12}}$ 上的算術運算更高效。

### Optimal Ate Pairing

BLS12-381 使用 Optimal Ate pairing，計算流程：

1. **Miller Loop**：沿著 $x = -\texttt{0xd201000000010000}$ 的 binary representation 做 double-and-add，累積中間值
2. **Final Exponentiation**：將 Miller Loop 的結果做 $(p^{12} - 1) / r$ 次冪，映射到 $G_T$ 的唯一代表

### 安全強度

BLS12-381 的設計目標是 128-bit 安全：

- ECDLP in $G_1$：$\approx 2^{128}$（Pollard's rho）
- ECDLP in $G_2$：$\approx 2^{128}$
- DLP in $G_T$（NFS in $\mathbb{F}_{p^{12}}$）：$\approx 2^{128}$

$p$ 選 381 bit（而非 256 bit）就是為了讓 $G_T$ 中的 NFS 攻擊也達到 128-bit 安全。

### 與 BN254 的比較

| | BN254 | BLS12-381 |
|--|-------|-----------|
| 基域 | 254 bit | 381 bit |
| 安全強度 | ~100 bit | ~128 bit |
| $G_1$ 元素大小 | 32 bytes | 48 bytes |
| $G_2$ 元素大小 | 64 bytes | 96 bytes |
| 用途 | 早期 zkSNARK | 現代共識層、KZG、新協議 |

BN254 因安全強度不足（NFS 攻擊進步使其降至約 100 bit），逐漸被 BLS12-381 取代。

## 程式碼範例

```python
from py_ecc.optimized_bls12_381 import (
    G1, G2, Z1, Z2,
    multiply, add, pairing, neg,
    curve_order,
)

# === 基本群運算 ===
# G1 生成元的純量乘法
P = multiply(G1, 42)
Q = multiply(G1, 58)
R = add(P, Q)
R_direct = multiply(G1, 100)
# R == R_direct（42G + 58G = 100G）

# === 驗證雙線性性質 ===
a = 3
b = 5

# e(aG1, bG2) == e(G1, G2)^(ab) == e(abG1, G2) == e(G1, abG2)
lhs = pairing(multiply(G2, b), multiply(G1, a))
rhs = pairing(multiply(G2, a * b), G1)
assert lhs == rhs
print("[OK] Bilinearity: e(aG1, bG2) == e(abG1, G2)")

# === 群的階驗證 ===
O = multiply(G1, curve_order)
assert O == Z1  # curve_order * G1 = identity
print("[OK] curve_order * G1 = O (identity)")
```

## 相關概念

- [橢圓曲線密碼學](/fundamentals/cryptography/elliptic-curve-cryptography/) - ECC 的通用原理
- [BLS Signatures](/fundamentals/cryptography/bls-signatures/) - 基於 BLS12-381 配對的簽章方案
- [secp256k1](/fundamentals/cryptography/secp256k1/) - 非 pairing-friendly 的曲線（另一種設計取向）
- [數位簽章概述](/fundamentals/cryptography/digital-signature-overview/) - 數位簽章方案總覽
- [公鑰密碼學](/fundamentals/cryptography/public-key-cryptography/) - 非對稱密碼學的通用概念
